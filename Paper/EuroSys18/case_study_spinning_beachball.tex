%symptom
The applications that throws spinning beachball is one main category of performance bugs.
The indicator is clear for user that the main ui thread fails to response, but without analysis tool, it is still hard to tell what cause it unresponsive. 
Base on our understanding of the spinning beachball mechanism, a shared variable "isCGEventIsMainThreadSpinning" is referenced by main thread and event thread in an application to indicate the state of the main thread.
Another variable "isDispatchedToMainThread" is set every time the event thread passes an event, user input or system defined, to main thread,
while the main thread will clear it every time it fetches an event from its queue.
If the event thread find the last time dispatched event is cleared, it will pass the event and re-arm a timer to monitor the waiting time of current event.
Once the timer fired, it means that the main thread has not fetched new event.
It will set "isCGEventIsMainThreadSpinning" and notify the WindowServer to change the appearance of the cursor to a spinning beachball.
\subsubsection{Google Chrome}
Google Chrome throws spinning beachball in a sequence of user inputs.
We can reproduce it in the following steps.
Switch the input method to Simplified Chinese to get prepared.
Open a new tab in the Chrome and go to yahoo.com.
Before the page get fully loaded, type any Chinese characters rapidly.
Usually the spinning cursor appears in the webpage if it gets the focus.
\par
To firgure out the cause of beachball cursor, we've tracked the shared variable "isCGEventIsMainThreadSpinning" with hardware breakpoint register.
In our generated dependency graph, we first use the search engine to position where the main thread is set spinning by checking the value of "isCGEventIsMainThreadSpinning".
It narrows down the end boundary of root cause.
Then the search engine will search up towards the timeline to get the last time "isDispatchedToMainThread" get cleared, from which we will get the beginning boundary of root cause.
With the boundary, we can analyze time span of each execution segments and the time cost of wait event in the main thread.
In this particular case, we find that the wait event in the main thread, from BSD system call psynch\_cvwait with a cost of one second, repeats twice.
The return value of psynch\_cvwait indicates timeout happened.
This is the straitforward reason of the spinning.
We further search threads that touch the condition variable with corresponding system calls, psynch\_cvbroad or psynch\_cvsignal.
The result shows that a worker thread that invokes psynch\_cvsignal intermittently does not call it any more, while the main thread still tries to wait for condition variable.
\subsubsection{Notes}
A second case is quite common in text editing softwares, including TextEdit, the serial softwares of Microsoft Office, Latex and so on. 
In those softwares when you edit a large text, you will encounter the beachball.
Examples like copying, pasting and changing the font size or style will trigger the unresponsiveness of the applications.
Sometimes, only a small amount edit can also trigger.
\par
We show the study of Notes app from Apple here.
Our experiments on other softwares gives the similar results.
We apply the similar serching method as the Google Chrome case to narrow down the search range of execution segments in the main thread.
In this case, we could not find the outstanding time spent on wait, but we found an execution segment spans around 8 seconds.
Inside the segment, we discoverred remarkable frequency of interrupts, including timer interrupts and inter processor interrupts.
With the symbolication of intruction pointer recorded in traced interrupt event, the main thread is busy on memory operations when the interrupts happen. 
Besides, from the backtrace, the main thred is also busy preparing the changes in the layouts and setting the need\_dispaly flags in NSView objects.
\subsubsection{System Preference}
A beachball will appear in the System preference setting panel when the application DisableMonitor is running in the system.
DisableMonitor is an application used to manage external monitors for pc.
The beachball appears when we use the DisableMonitor to close the external connected monitor first, and then try to arrange the displayers in System Preferences.
Applying the tool for diagnosis, we find the most frequently appears API is thread\_switch in the long execution segment of main thread.
\subsubsection{Installer}
Spinning beachball appears during the process of application installation.
When there is a small input box waiting for password and you move the cursor over the underlying installer box, the spinning beachball comes out on the screen.

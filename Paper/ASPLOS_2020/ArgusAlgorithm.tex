\begin{algorithm}[ht!]
    \caption{Diagnosis algorithm.}
    \label{alg:alg-diagnosis}
\begin{algorithmic}[1]
\Require{g - EventGraph; spinning\_node - the node in the UI thread when the spinning cursor occurs}
\Ensure{root\_cause\_nodes-collecting root casuse nodes for user inspect}
\Statex
\Function{Diagnose}{g, spinning\_node}
  \Switch {spinning\_node.block\_type}
    \Case {LongRunning}
		\State {slice $\gets$ InteractiveSlice(spinning\_node)}
		\State\Return {node contains UI event}
	\EndCase
	\Case {RepeatedYield}
		\If {DataFlagEvent $\notin$ $\{$event types in spinning\_node$\}$}
			\State {Require users to annotate data flag}
			\State {abort()}
		\EndIf
		%\LineComment {Fall through}
	\EndCase
	\Case {LongWait}
		%\LineComment {find a baseline case where the wait returns quickly}
		%\LineComment {slice baseline path and check the path thread to thread}
		%\LineComment {check its nearest (to spinning timestamp) node}
		\State {$T_{spinning}$ $\gets$ timestamp of spinning in spinning\_node}
		\State {similar\_nodes $\gets$ nodes have similar event sequences to spinning\_node}
		\State {baseline\_node $\gets$ ask user to pick from similar\_nodes} 
		\State {baseline\_path $\gets$ InteractiveSlice(baseline\_node)} 	
		\For {t $\gets$ $\{$threads in baseline\_path$\}$}
			\State {$node_t$ $\gets$ node in t before $T_{spinning}$}
			\If {$node_t$ $\in$ $\{$LongRunning, RepeatedYield, LongWait$\}$}
				\State{is\_related\_to\_bug $\gets$ ask user if $node_t$ related to bug}
				\If {is\_related\_to\_bug $\not=$ True}
					\State{Continue}
				\EndIf
				\State {root\_cause\_nodes.append($node_t$)}
				\State {root\_cause\_nodes.append(Diagnose(g, last\_node))}
			\EndIf
			\LineComment{if t is normal running, disgnose the next thread}
		\EndFor
	\EndCase
  \EndSwitch
\EndFunction
\end{algorithmic}
\end{algorithm}


\begin{algorithm}[ht!]
    \caption{InteractiveSlicing algorithm.}
    \label{alg:alg-interactiveslicing}
\begin{algorithmic}[1]
\Require{g - EventGraph; node - the node user wants to slice from}
\Ensure{slice - causual path for node}
\Statex
\Function{InteractiveSlicing}{EventGraph g, Node *node}
\Loop
	\State{slice.append(node)}
	\If{node.parent().size() > 1}
		\State{node $\gets$ User.pick(candidates)}
		\If{node.NotExist()}
			\State\Return {slice}
		\EndIf
	\ElsIf{node.parent().size() == 1}
		\State{node $\gets$ node.parent().front()}
	\ElsIf{node.WeakEdges().size() > 0}
		\State{node $\gets$ User.Pick(weak edges)}
		\If{node.NotExist()}
			\State\Return {slice}
		\EndIf
	\Else \Comment{The very beginning dangle node of current thread}
		\State\Return {slice}
	\EndIf
\EndLoop
\EndFunction
\end{algorithmic}
\end{algorithm}

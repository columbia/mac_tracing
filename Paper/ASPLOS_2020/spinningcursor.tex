%\subsection{Spinning Node detection}
\indent Spinning beachball is a painful sight for Mac users, signifying that an
application is non-responsive and leaving the user at a loss and unable to do
anything productive. In this situation, a hang reporting tool, spindump, usually
kicks in automatically by root to sample for debugging.

To figure out the spinning node in the main thread, we turn to the event
graph, and slice path backward from the launch of spindump, considering it is
another indicator of non-responsive in app. The path showed it was launched
after receiving a message from WindowServer, which in turn received a message
from the NSEvent thread of the freezing app. The call stacks attached to the
messages further revealed NSEvent thread per process fetches CoreGraphics events
from WindowServer, converts and creates NSApp\_event for the main thread. If the
main thread is not spinning ,a timer is armed. If the main thread processes
the next event before the timer fires, nothing happens and the timer gets
re-armed. Otherwise, NSEvent thread sends a message to WindowServer via the
API ``\vv{CGSConnectionSetSpinning}''from the timer handler, and WindowServer
notifies the CoreGraphics to draw a spinning wait cursor over the application
window.

Moreover, two shared variables are discovered helps \xxx to identifying
spinning node in main thread. With the call stack symbols found above
as input, our detailed debugging script detects two shared variables
``\vv{is\_mainthread\_spinning}'' and ``\vv{dispatch\_to\_mainthread}'' which
are used to identify the main thread status. As a result, \xxx can make use of
either the API or the shared variable to identify the spinning node in the main
thread.%and the UI event cause the hanging.
